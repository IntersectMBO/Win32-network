<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LINE 1 &quot;src\\System\\Win32\\NamedPipes.hsc&quot; #-}</span><span>
</span><span id="line-1"></span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE CPP                #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE BangPatterns       #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf         #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE NumericUnderscores #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-comment">-- | For full details on the Windows named pipes API see</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- &lt;https://docs.microsoft.com/en-us/windows/desktop/ipc/named-pipes&gt;</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">System.Win32.NamedPipes</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-comment">-- * Named pipe server APIs</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="System.Win32.NamedPipes.html#createNamedPipe"><span class="hs-identifier">createNamedPipe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="System.Win32.NamedPipes.html#pIPE_UNLIMITED_INSTANCES"><span class="hs-identifier">pIPE_UNLIMITED_INSTANCES</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-comment">-- ** Parameter types</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><span class="hs-identifier">LPSECURITY_ATTRIBUTES</span></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="System.Win32.NamedPipes.html#OpenMode"><span class="hs-identifier">OpenMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="System.Win32.NamedPipes.html#pIPE_ACCESS_DUPLEX"><span class="hs-identifier">pIPE_ACCESS_DUPLEX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="System.Win32.NamedPipes.html#pIPE_ACCESS_INBOUND"><span class="hs-identifier">pIPE_ACCESS_INBOUND</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="System.Win32.NamedPipes.html#pIPE_ACCESS_OUTBOUND"><span class="hs-identifier">pIPE_ACCESS_OUTBOUND</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><span class="hs-identifier">fILE_FLAG_OVERLAPPED</span></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="System.Win32.NamedPipes.html#PipeMode"><span class="hs-identifier">PipeMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="System.Win32.NamedPipes.html#pIPE_TYPE_BYTE"><span class="hs-identifier">pIPE_TYPE_BYTE</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="System.Win32.NamedPipes.html#pIPE_TYPE_MESSAGE"><span class="hs-identifier">pIPE_TYPE_MESSAGE</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="System.Win32.NamedPipes.html#pIPE_READMODE_BYTE"><span class="hs-identifier">pIPE_READMODE_BYTE</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="System.Win32.NamedPipes.html#pIPE_READMODE_MESSAGE"><span class="hs-identifier">pIPE_READMODE_MESSAGE</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-comment">-- * Named pipe client APIs</span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-comment">-- ** connect to a named pipe</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><a href="System.Win32.NamedPipes.html#connect"><span class="hs-identifier">connect</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-comment">-- ** waiting for named pipe instances</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="System.Win32.NamedPipes.html#waitNamedPipe"><span class="hs-identifier">waitNamedPipe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><a href="System.Win32.NamedPipes.html#TimeOut"><span class="hs-identifier">TimeOut</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><a href="System.Win32.NamedPipes.html#nMPWAIT_USE_DEFAULT_WAIT"><span class="hs-identifier">nMPWAIT_USE_DEFAULT_WAIT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><a href="System.Win32.NamedPipes.html#nMPWAIT_WAIT_FOREVER"><span class="hs-identifier">nMPWAIT_WAIT_FOREVER</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.C.String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">withCString</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Win32.Types</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">try</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Win32.File</span></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-comment">-- | The named pipe open mode.</span><span>
</span><span id="line-52"></span><span class="hs-comment">--</span><span>
</span><span id="line-53"></span><span class="hs-comment">-- This must specify one of:</span><span>
</span><span id="line-54"></span><span class="hs-comment">--</span><span>
</span><span id="line-55"></span><span class="hs-comment">-- * 'pIPE_ACCESS_DUPLEX'</span><span>
</span><span id="line-56"></span><span class="hs-comment">-- * 'pIPE_ACCESS_INBOUND'</span><span>
</span><span id="line-57"></span><span class="hs-comment">-- * 'pIPE_ACCESS_OUTBOUND'</span><span>
</span><span id="line-58"></span><span class="hs-comment">--</span><span>
</span><span id="line-59"></span><span class="hs-comment">-- It may also specify:</span><span>
</span><span id="line-60"></span><span class="hs-comment">--</span><span>
</span><span id="line-61"></span><span class="hs-comment">-- * 'fILE_FLAG_WRITE_THROUGH'</span><span>
</span><span id="line-62"></span><span class="hs-comment">-- * 'fILE_FLAG_OVERLAPPED'</span><span>
</span><span id="line-63"></span><span class="hs-comment">--</span><span>
</span><span id="line-64"></span><span class="hs-comment">-- It may also specify any combination of:</span><span>
</span><span id="line-65"></span><span class="hs-comment">--</span><span>
</span><span id="line-66"></span><span class="hs-comment">-- * 'wRITE_DAC'</span><span>
</span><span id="line-67"></span><span class="hs-comment">-- * 'wRITE_OWNER'</span><span>
</span><span id="line-68"></span><span class="hs-comment">-- * 'aCCESS_SYSTEM_SECURITY'</span><span>
</span><span id="line-69"></span><span class="hs-comment">--</span><span>
</span><span id="line-70"></span><span class="hs-keyword">type</span><span> </span><span id="OpenMode"><span class="annot"><a href="System.Win32.NamedPipes.html#OpenMode"><span class="hs-identifier hs-var">OpenMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UINT</span></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="annot"><a href="System.Win32.NamedPipes.html#pIPE_ACCESS_DUPLEX"><span class="hs-identifier hs-type">pIPE_ACCESS_DUPLEX</span></a></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Win32.NamedPipes.html#OpenMode"><span class="hs-identifier hs-type">OpenMode</span></a></span><span>
</span><span id="line-73"></span><span id="pIPE_ACCESS_DUPLEX"><span class="annot"><span class="annottext">pIPE_ACCESS_DUPLEX :: OpenMode
</span><a href="System.Win32.NamedPipes.html#pIPE_ACCESS_DUPLEX"><span class="hs-identifier hs-var hs-var">pIPE_ACCESS_DUPLEX</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">OpenMode
</span><span class="hs-number">3</span></span><span>
</span><span id="line-74"></span><span class="annot"><a href="System.Win32.NamedPipes.html#pIPE_ACCESS_INBOUND"><span class="hs-identifier hs-type">pIPE_ACCESS_INBOUND</span></a></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Win32.NamedPipes.html#OpenMode"><span class="hs-identifier hs-type">OpenMode</span></a></span><span>
</span><span id="line-75"></span><span id="pIPE_ACCESS_INBOUND"><span class="annot"><span class="annottext">pIPE_ACCESS_INBOUND :: OpenMode
</span><a href="System.Win32.NamedPipes.html#pIPE_ACCESS_INBOUND"><span class="hs-identifier hs-var hs-var">pIPE_ACCESS_INBOUND</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">OpenMode
</span><span class="hs-number">1</span></span><span>
</span><span id="line-76"></span><span class="annot"><a href="System.Win32.NamedPipes.html#pIPE_ACCESS_OUTBOUND"><span class="hs-identifier hs-type">pIPE_ACCESS_OUTBOUND</span></a></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Win32.NamedPipes.html#OpenMode"><span class="hs-identifier hs-type">OpenMode</span></a></span><span>
</span><span id="line-77"></span><span id="pIPE_ACCESS_OUTBOUND"><span class="annot"><span class="annottext">pIPE_ACCESS_OUTBOUND :: OpenMode
</span><a href="System.Win32.NamedPipes.html#pIPE_ACCESS_OUTBOUND"><span class="hs-identifier hs-var hs-var">pIPE_ACCESS_OUTBOUND</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">OpenMode
</span><span class="hs-number">2</span></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-pragma">{-# LINE 77 &quot;src\\System\\Win32\\NamedPipes.hsc&quot; #-}</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-comment">-- | The pipe mode.</span><span>
</span><span id="line-79"></span><span class="hs-comment">--</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- One of the following type modes can be specified. The same type mode must be</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- specified for each instance of the pipe.</span><span>
</span><span id="line-82"></span><span class="hs-comment">--</span><span>
</span><span id="line-83"></span><span class="hs-comment">-- * 'pIPE_TYPE_BYTE'</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- * 'pIPE_TYPE_MESSAGE'</span><span>
</span><span id="line-85"></span><span class="hs-comment">--</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- One of the following read modes can be specified. Different instances of the</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- same pipe can specify different read modes.</span><span>
</span><span id="line-88"></span><span class="hs-comment">--</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- * 'pIPE_READMODE_BYTE'</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- * 'pIPE_READMODE_MESSAGE'</span><span>
</span><span id="line-91"></span><span class="hs-comment">--</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- We're not exposing 'PIPE_NOWAIT' (and the default 'PIPE_WAIT'), as these</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- should not be used for async I/O (ref:</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- &lt;https://docs.microsoft.com/en-us/windows/win32/ipc/named-pipe-type-read-and-wait-modes&gt;).</span><span>
</span><span id="line-95"></span><span class="hs-comment">--</span><span>
</span><span id="line-96"></span><span class="hs-keyword">type</span><span> </span><span id="PipeMode"><span class="annot"><a href="System.Win32.NamedPipes.html#PipeMode"><span class="hs-identifier hs-var">PipeMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UINT</span></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="annot"><a href="System.Win32.NamedPipes.html#pIPE_TYPE_BYTE"><span class="hs-identifier hs-type">pIPE_TYPE_BYTE</span></a></span><span>                 </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Win32.NamedPipes.html#PipeMode"><span class="hs-identifier hs-type">PipeMode</span></a></span><span>
</span><span id="line-99"></span><span id="pIPE_TYPE_BYTE"><span class="annot"><span class="annottext">pIPE_TYPE_BYTE :: OpenMode
</span><a href="System.Win32.NamedPipes.html#pIPE_TYPE_BYTE"><span class="hs-identifier hs-var hs-var">pIPE_TYPE_BYTE</span></a></span></span><span>                 </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">OpenMode
</span><span class="hs-number">0</span></span><span>
</span><span id="line-100"></span><span class="annot"><a href="System.Win32.NamedPipes.html#pIPE_TYPE_MESSAGE"><span class="hs-identifier hs-type">pIPE_TYPE_MESSAGE</span></a></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Win32.NamedPipes.html#PipeMode"><span class="hs-identifier hs-type">PipeMode</span></a></span><span>
</span><span id="line-101"></span><span id="pIPE_TYPE_MESSAGE"><span class="annot"><span class="annottext">pIPE_TYPE_MESSAGE :: OpenMode
</span><a href="System.Win32.NamedPipes.html#pIPE_TYPE_MESSAGE"><span class="hs-identifier hs-var hs-var">pIPE_TYPE_MESSAGE</span></a></span></span><span>              </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">OpenMode
</span><span class="hs-number">4</span></span><span>
</span><span id="line-102"></span><span class="annot"><a href="System.Win32.NamedPipes.html#pIPE_READMODE_BYTE"><span class="hs-identifier hs-type">pIPE_READMODE_BYTE</span></a></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Win32.NamedPipes.html#PipeMode"><span class="hs-identifier hs-type">PipeMode</span></a></span><span>
</span><span id="line-103"></span><span id="pIPE_READMODE_BYTE"><span class="annot"><span class="annottext">pIPE_READMODE_BYTE :: OpenMode
</span><a href="System.Win32.NamedPipes.html#pIPE_READMODE_BYTE"><span class="hs-identifier hs-var hs-var">pIPE_READMODE_BYTE</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">OpenMode
</span><span class="hs-number">0</span></span><span>
</span><span id="line-104"></span><span class="annot"><a href="System.Win32.NamedPipes.html#pIPE_READMODE_MESSAGE"><span class="hs-identifier hs-type">pIPE_READMODE_MESSAGE</span></a></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Win32.NamedPipes.html#PipeMode"><span class="hs-identifier hs-type">PipeMode</span></a></span><span>
</span><span id="line-105"></span><span id="pIPE_READMODE_MESSAGE"><span class="annot"><span class="annottext">pIPE_READMODE_MESSAGE :: OpenMode
</span><a href="System.Win32.NamedPipes.html#pIPE_READMODE_MESSAGE"><span class="hs-identifier hs-var hs-var">pIPE_READMODE_MESSAGE</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">OpenMode
</span><span class="hs-number">2</span></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-pragma">{-# LINE 104 &quot;src\\System\\Win32\\NamedPipes.hsc&quot; #-}</span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-comment">-- | If the 'createNamedPipe' @nMaxInstances@ parameter is</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- 'pIPE_UNLIMITED_INSTANCES', the number of pipe instances that can be created</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- is limited only by the availability of system resources.</span><span>
</span><span id="line-108"></span><span class="annot"><a href="System.Win32.NamedPipes.html#pIPE_UNLIMITED_INSTANCES"><span class="hs-identifier hs-type">pIPE_UNLIMITED_INSTANCES</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DWORD</span></span><span>
</span><span id="line-109"></span><span id="pIPE_UNLIMITED_INSTANCES"><span class="annot"><span class="annottext">pIPE_UNLIMITED_INSTANCES :: OpenMode
</span><a href="System.Win32.NamedPipes.html#pIPE_UNLIMITED_INSTANCES"><span class="hs-identifier hs-var hs-var">pIPE_UNLIMITED_INSTANCES</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpenMode
</span><span class="hs-number">255</span></span><span>
</span><span id="line-110"></span><span class="hs-pragma">{-# LINE 110 &quot;src\\System\\Win32\\NamedPipes.hsc&quot; #-}</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-comment">-- | Creates an instance of a named pipe and returns a handle for subsequent</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- pipe operations. A named pipe server process uses this function either to</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- create the first instance of a specific named pipe and establish its basic</span><span>
</span><span id="line-114"></span><span class="hs-comment">-- attributes or to create a new instance of an existing named pipe.</span><span>
</span><span id="line-115"></span><span class="hs-comment">--</span><span>
</span><span id="line-116"></span><span class="hs-comment">-- For full details see</span><span>
</span><span id="line-117"></span><span class="hs-comment">-- &lt;https://docs.microsoft.com/en-us/windows/desktop/api/winbase/nf-winbase-createnamedpipea&gt;</span><span>
</span><span id="line-118"></span><span class="hs-comment">--</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- To create a named pipe which can be associate with IO completion port on</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- needs to pass 'fILE_FLAG_OVERLAPPED' to 'OpenMode' argument,</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- e.g.</span><span>
</span><span id="line-122"></span><span class="hs-comment">--</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- &gt;  Win32.createNamedPipe pipeName</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- &gt;                        (pIPE_ACCESS_DUPLEX .|. fILE_FLAG_OVERLAPPED)</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- &gt;                        (pIPE_TYPE_BYTE .|. pIPE_READMODE_BYTE)</span><span>
</span><span id="line-126"></span><span class="hs-comment">-- &gt;                        pIPE_UNLIMITED_INSTANCES</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- &gt;                        512</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- &gt;                        512</span><span>
</span><span id="line-129"></span><span class="hs-comment">-- &gt;                        0</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- &gt;                        Nothing</span><span>
</span><span id="line-131"></span><span class="hs-comment">--</span><span>
</span><span id="line-132"></span><span class="hs-comment">--</span><span>
</span><span id="line-133"></span><span class="annot"><a href="System.Win32.NamedPipes.html#createNamedPipe"><span class="hs-identifier hs-type">createNamedPipe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>   </span><span class="hs-comment">-- ^ pipe name of form @\\.\pipe\{pipename}@</span><span>
</span><span id="line-134"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Win32.NamedPipes.html#OpenMode"><span class="hs-identifier hs-type">OpenMode</span></a></span><span>
</span><span id="line-135"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Win32.NamedPipes.html#PipeMode"><span class="hs-identifier hs-type">PipeMode</span></a></span><span>
</span><span id="line-136"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DWORD</span></span><span>    </span><span class="hs-comment">-- ^ nMaxInstances</span><span>
</span><span id="line-137"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DWORD</span></span><span>    </span><span class="hs-comment">-- ^ nOutBufferSize</span><span>
</span><span id="line-138"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DWORD</span></span><span>    </span><span class="hs-comment">-- ^ nInBufferSize</span><span>
</span><span id="line-139"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DWORD</span></span><span>    </span><span class="hs-comment">-- ^ nDefaultTimeOut</span><span>
</span><span id="line-140"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LPSECURITY_ATTRIBUTES</span></span><span>
</span><span id="line-141"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HANDLE</span></span><span>
</span><span id="line-142"></span><span id="createNamedPipe"><span class="annot"><span class="annottext">createNamedPipe :: String
-&gt; OpenMode
-&gt; OpenMode
-&gt; OpenMode
-&gt; OpenMode
-&gt; OpenMode
-&gt; OpenMode
-&gt; Maybe LPSECURITY_ATTRIBUTES
-&gt; IO LPSECURITY_ATTRIBUTES
</span><a href="System.Win32.NamedPipes.html#createNamedPipe"><span class="hs-identifier hs-var hs-var">createNamedPipe</span></a></span></span><span> </span><span id="local-6989586621679045875"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679045875"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679045874"><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045874"><span class="hs-identifier hs-var">openMode</span></a></span></span><span> </span><span id="local-6989586621679045873"><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045873"><span class="hs-identifier hs-var">pipeMode</span></a></span></span><span>
</span><span id="line-143"></span><span>                </span><span id="local-6989586621679045872"><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045872"><span class="hs-identifier hs-var">nMaxInstances</span></a></span></span><span> </span><span id="local-6989586621679045871"><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045871"><span class="hs-identifier hs-var">nOutBufferSize</span></a></span></span><span> </span><span id="local-6989586621679045870"><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045870"><span class="hs-identifier hs-var">nInBufferSize</span></a></span></span><span>
</span><span id="line-144"></span><span>                </span><span id="local-6989586621679045869"><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045869"><span class="hs-identifier hs-var">nDefaultTimeOut</span></a></span></span><span> </span><span id="local-6989586621679045868"><span class="annot"><span class="annottext">Maybe LPSECURITY_ATTRIBUTES
</span><a href="#local-6989586621679045868"><span class="hs-identifier hs-var">mb_attr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-145"></span><span>  </span><span class="annot"><span class="annottext">String
-&gt; (LPTSTR -&gt; IO LPSECURITY_ATTRIBUTES) -&gt; IO LPSECURITY_ATTRIBUTES
forall a. String -&gt; (LPTSTR -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">withTString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679045875"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">((LPTSTR -&gt; IO LPSECURITY_ATTRIBUTES) -&gt; IO LPSECURITY_ATTRIBUTES)
-&gt; (LPTSTR -&gt; IO LPSECURITY_ATTRIBUTES) -&gt; IO LPSECURITY_ATTRIBUTES
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679045866"><span class="annot"><span class="annottext">LPTSTR
</span><a href="#local-6989586621679045866"><span class="hs-identifier hs-var">c_name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><span class="annottext">(LPSECURITY_ATTRIBUTES -&gt; Bool)
-&gt; String -&gt; IO LPSECURITY_ATTRIBUTES -&gt; IO LPSECURITY_ATTRIBUTES
forall a. (a -&gt; Bool) -&gt; String -&gt; IO a -&gt; IO a
</span><span class="hs-identifier hs-var">failIf</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LPSECURITY_ATTRIBUTES -&gt; LPSECURITY_ATTRIBUTES -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">LPSECURITY_ATTRIBUTES
</span><span class="hs-identifier hs-var">iNVALID_HANDLE_VALUE</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CreateNamedPipe ('&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679045875"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;')&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO LPSECURITY_ATTRIBUTES -&gt; IO LPSECURITY_ATTRIBUTES)
-&gt; IO LPSECURITY_ATTRIBUTES -&gt; IO LPSECURITY_ATTRIBUTES
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-147"></span><span>      </span><span class="annot"><span class="annottext">LPTSTR
-&gt; OpenMode
-&gt; OpenMode
-&gt; OpenMode
-&gt; OpenMode
-&gt; OpenMode
-&gt; OpenMode
-&gt; LPSECURITY_ATTRIBUTES
-&gt; IO LPSECURITY_ATTRIBUTES
</span><a href="System.Win32.NamedPipes.html#c_CreateNamedPipe"><span class="hs-identifier hs-var">c_CreateNamedPipe</span></a></span><span> </span><span class="annot"><span class="annottext">LPTSTR
</span><a href="#local-6989586621679045866"><span class="hs-identifier hs-var">c_name</span></a></span><span> </span><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045874"><span class="hs-identifier hs-var">openMode</span></a></span><span> </span><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045873"><span class="hs-identifier hs-var">pipeMode</span></a></span><span>
</span><span id="line-148"></span><span>                        </span><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045872"><span class="hs-identifier hs-var">nMaxInstances</span></a></span><span> </span><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045871"><span class="hs-identifier hs-var">nOutBufferSize</span></a></span><span> </span><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045870"><span class="hs-identifier hs-var">nInBufferSize</span></a></span><span>
</span><span id="line-149"></span><span>                        </span><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045869"><span class="hs-identifier hs-var">nDefaultTimeOut</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe LPSECURITY_ATTRIBUTES -&gt; LPSECURITY_ATTRIBUTES
forall a. Maybe (Ptr a) -&gt; Ptr a
</span><span class="hs-identifier hs-var">maybePtr</span></span><span> </span><span class="annot"><span class="annottext">Maybe LPSECURITY_ATTRIBUTES
</span><a href="#local-6989586621679045868"><span class="hs-identifier hs-var">mb_attr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">unsafe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;windows.h CreateNamedPipeW&quot;</span></span><span>
</span><span id="line-152"></span><span>  </span><span id="c_CreateNamedPipe"><span class="annot"><a href="System.Win32.NamedPipes.html#c_CreateNamedPipe"><span class="hs-identifier hs-var">c_CreateNamedPipe</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LPCTSTR</span></span><span>
</span><span id="line-153"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DWORD</span></span><span>
</span><span id="line-154"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DWORD</span></span><span>
</span><span id="line-155"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DWORD</span></span><span>
</span><span id="line-156"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DWORD</span></span><span>
</span><span id="line-157"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DWORD</span></span><span>
</span><span id="line-158"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DWORD</span></span><span>
</span><span id="line-159"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LPSECURITY_ATTRIBUTES</span></span><span>
</span><span id="line-160"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HANDLE</span></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-comment">-- | Timeout in milliseconds.</span><span>
</span><span id="line-164"></span><span class="hs-comment">--</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- * 'nMPWAIT_USE_DEFAULT_WAIT' indicates that the timeout value passed to</span><span>
</span><span id="line-166"></span><span class="hs-comment">--   'createNamedPipe' should be used.</span><span>
</span><span id="line-167"></span><span class="hs-comment">-- * 'nMPWAIT_WAIT_FOREVER' - 'waitNamedPipe' will block forever, until a named</span><span>
</span><span id="line-168"></span><span class="hs-comment">--   pipe instance is available.</span><span>
</span><span id="line-169"></span><span class="hs-comment">--</span><span>
</span><span id="line-170"></span><span class="hs-keyword">type</span><span> </span><span id="TimeOut"><span class="annot"><a href="System.Win32.NamedPipes.html#TimeOut"><span class="hs-identifier hs-var">TimeOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DWORD</span></span><span>
</span><span id="line-171"></span><span class="annot"><a href="System.Win32.NamedPipes.html#nMPWAIT_USE_DEFAULT_WAIT"><span class="hs-identifier hs-type">nMPWAIT_USE_DEFAULT_WAIT</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Win32.NamedPipes.html#TimeOut"><span class="hs-identifier hs-type">TimeOut</span></a></span><span>
</span><span id="line-172"></span><span id="nMPWAIT_USE_DEFAULT_WAIT"><span class="annot"><span class="annottext">nMPWAIT_USE_DEFAULT_WAIT :: OpenMode
</span><a href="System.Win32.NamedPipes.html#nMPWAIT_USE_DEFAULT_WAIT"><span class="hs-identifier hs-var hs-var">nMPWAIT_USE_DEFAULT_WAIT</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">OpenMode
</span><span class="hs-number">0</span></span><span>
</span><span id="line-173"></span><span class="annot"><a href="System.Win32.NamedPipes.html#nMPWAIT_WAIT_FOREVER"><span class="hs-identifier hs-type">nMPWAIT_WAIT_FOREVER</span></a></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Win32.NamedPipes.html#TimeOut"><span class="hs-identifier hs-type">TimeOut</span></a></span><span>
</span><span id="line-174"></span><span id="nMPWAIT_WAIT_FOREVER"><span class="annot"><span class="annottext">nMPWAIT_WAIT_FOREVER :: OpenMode
</span><a href="System.Win32.NamedPipes.html#nMPWAIT_WAIT_FOREVER"><span class="hs-identifier hs-var hs-var">nMPWAIT_WAIT_FOREVER</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">OpenMode
</span><span class="hs-number">4294967295</span></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-pragma">{-# LINE 175 &quot;src\\System\\Win32\\NamedPipes.hsc&quot; #-}</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-comment">-- | Wait until a named pipe instance is available.  If there is no instance at</span><span>
</span><span id="line-178"></span><span class="hs-comment">-- hand before the timeout, it will error with 'ERROR_SEM_TIMEOUT', i.e.</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- @invalid argument (The semaphore timeout period has expired)@</span><span>
</span><span id="line-180"></span><span class="hs-comment">--</span><span>
</span><span id="line-181"></span><span class="hs-comment">-- It returns 'True' if there is an available instance, subsequent 'createFile'</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- might still fail, if another thread will take turn and connect before, or if</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- the other end shuts down the name pipe.</span><span>
</span><span id="line-184"></span><span class="hs-comment">--</span><span>
</span><span id="line-185"></span><span class="hs-comment">-- It returns 'False' if timeout fired.</span><span>
</span><span id="line-186"></span><span class="hs-comment">--</span><span>
</span><span id="line-187"></span><span class="annot"><a href="System.Win32.NamedPipes.html#waitNamedPipe"><span class="hs-identifier hs-type">waitNamedPipe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>  </span><span class="hs-comment">-- ^ pipe name</span><span>
</span><span id="line-188"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Win32.NamedPipes.html#TimeOut"><span class="hs-identifier hs-type">TimeOut</span></a></span><span> </span><span class="hs-comment">-- ^ nTimeOut</span><span>
</span><span id="line-189"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-190"></span><span id="waitNamedPipe"><span class="annot"><span class="annottext">waitNamedPipe :: String -&gt; OpenMode -&gt; IO Bool
</span><a href="System.Win32.NamedPipes.html#waitNamedPipe"><span class="hs-identifier hs-var hs-var">waitNamedPipe</span></a></span></span><span> </span><span id="local-6989586621679045860"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679045860"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679045859"><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045859"><span class="hs-identifier hs-var">timeout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; (CString -&gt; IO Bool) -&gt; IO Bool
forall a. String -&gt; (CString -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">withCString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679045860"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">((CString -&gt; IO Bool) -&gt; IO Bool)
-&gt; (CString -&gt; IO Bool) -&gt; IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679045858"><span class="annot"><span class="annottext">CString
</span><a href="#local-6989586621679045858"><span class="hs-identifier hs-var">c_name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-192"></span><span>      </span><span id="local-6989586621679045857"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679045857"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CString -&gt; OpenMode -&gt; IO Bool
</span><a href="System.Win32.NamedPipes.html#c_WaitNamedPipe"><span class="hs-identifier hs-var">c_WaitNamedPipe</span></a></span><span> </span><span class="annot"><span class="annottext">CString
</span><a href="#local-6989586621679045858"><span class="hs-identifier hs-var">c_name</span></a></span><span> </span><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045859"><span class="hs-identifier hs-var">timeout</span></a></span><span>
</span><span id="line-193"></span><span>      </span><span id="local-6989586621679045855"><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045855"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO OpenMode
</span><span class="hs-identifier hs-var">getLastError</span></span><span>
</span><span id="line-194"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679045857"><span class="hs-identifier hs-var">r</span></a></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679045857"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-195"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045855"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">OpenMode -&gt; OpenMode -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OpenMode
</span><a href="System.Win32.NamedPipes.html#eRROR_SEM_TIMEOUT"><span class="hs-identifier hs-var">eRROR_SEM_TIMEOUT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-196"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; OpenMode -&gt; IO Bool
forall a. String -&gt; OpenMode -&gt; IO a
</span><span class="hs-identifier hs-var">failWith</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;waitNamedPipe&quot;</span></span><span> </span><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045855"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-comment">-- 'c_WaitNamedPipe' is a blocking call, hence the _safe_ import.</span><span>
</span><span id="line-200"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">safe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;windows.h WaitNamedPipeA&quot;</span></span><span>
</span><span id="line-201"></span><span>  </span><span id="c_WaitNamedPipe"><span class="annot"><a href="System.Win32.NamedPipes.html#c_WaitNamedPipe"><span class="hs-identifier hs-var">c_WaitNamedPipe</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LPCSTR</span></span><span> </span><span class="hs-comment">-- lpNamedPipeName</span><span>
</span><span id="line-202"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DWORD</span></span><span>  </span><span class="hs-comment">-- nTimeOut</span><span>
</span><span id="line-203"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BOOL</span></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-comment">-- | A reliable connect call, as designed in</span><span>
</span><span id="line-206"></span><span class="hs-comment">-- &lt;https://docs.microsoft.com/en-us/windows/win32/ipc/named-pipe-client&gt;</span><span>
</span><span id="line-207"></span><span class="hs-comment">--</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- The arguments are passed directly to 'createFile'.</span><span>
</span><span id="line-209"></span><span class="hs-comment">--</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- Note we pick the more familiar posix naming convention, do not confuse this</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- function with 'connectNamedPipe' (which corresponds to posix 'accept')</span><span>
</span><span id="line-212"></span><span class="hs-comment">--</span><span>
</span><span id="line-213"></span><span class="annot"><a href="System.Win32.NamedPipes.html#connect"><span class="hs-identifier hs-type">connect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>                      </span><span class="hs-comment">-- ^ file name</span><span>
</span><span id="line-214"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">AccessMode</span></span><span>                  </span><span class="hs-comment">-- ^ dwDesiredAccess</span><span>
</span><span id="line-215"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShareMode</span></span><span>                   </span><span class="hs-comment">-- ^ dwSharedMode</span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LPSECURITY_ATTRIBUTES</span></span><span> </span><span class="hs-comment">-- ^ lpSecurityAttributes</span><span>
</span><span id="line-217"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CreateMode</span></span><span>                  </span><span class="hs-comment">-- ^ dwCreationDisposition</span><span>
</span><span id="line-218"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FileAttributeOrFlag</span></span><span>         </span><span class="hs-comment">-- ^ dwFlagsAndAttributes</span><span>
</span><span id="line-219"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HANDLE</span></span><span>                </span><span class="hs-comment">-- ^ hTemplateFile</span><span>
</span><span id="line-220"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HANDLE</span></span><span>
</span><span id="line-221"></span><span id="connect"><span class="annot"><span class="annottext">connect :: String
-&gt; OpenMode
-&gt; OpenMode
-&gt; Maybe LPSECURITY_ATTRIBUTES
-&gt; OpenMode
-&gt; OpenMode
-&gt; Maybe LPSECURITY_ATTRIBUTES
-&gt; IO LPSECURITY_ATTRIBUTES
</span><a href="System.Win32.NamedPipes.html#connect"><span class="hs-identifier hs-var hs-var">connect</span></a></span></span><span> </span><span id="local-6989586621679045845"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679045845"><span class="hs-identifier hs-var">fileName</span></a></span></span><span> </span><span id="local-6989586621679045844"><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045844"><span class="hs-identifier hs-var">dwDesiredAccess</span></a></span></span><span> </span><span id="local-6989586621679045843"><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045843"><span class="hs-identifier hs-var">dwSharedMode</span></a></span></span><span> </span><span id="local-6989586621679045842"><span class="annot"><span class="annottext">Maybe LPSECURITY_ATTRIBUTES
</span><a href="#local-6989586621679045842"><span class="hs-identifier hs-var">lpSecurityAttributes</span></a></span></span><span> </span><span id="local-6989586621679045841"><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045841"><span class="hs-identifier hs-var">dwCreationDisposition</span></a></span></span><span> </span><span id="local-6989586621679045840"><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045840"><span class="hs-identifier hs-var">dwFlagsAndAttributes</span></a></span></span><span> </span><span id="local-6989586621679045839"><span class="annot"><span class="annottext">Maybe LPSECURITY_ATTRIBUTES
</span><a href="#local-6989586621679045839"><span class="hs-identifier hs-var">hTemplateFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO LPSECURITY_ATTRIBUTES
</span><a href="#local-6989586621679045838"><span class="hs-identifier hs-var">connectLoop</span></a></span><span>
</span><span id="line-222"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-223"></span><span>    </span><span id="local-6989586621679045838"><span class="annot"><span class="annottext">connectLoop :: IO LPSECURITY_ATTRIBUTES
</span><a href="#local-6989586621679045838"><span class="hs-identifier hs-var hs-var">connectLoop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-224"></span><span>      </span><span class="hs-comment">-- `createFile` checks for `INVALID_HANDLE_VALUE` and retries if this is</span><span>
</span><span id="line-225"></span><span>      </span><span class="hs-comment">-- caused by `ERROR_SHARING_VIOLATION`.</span><span>
</span><span id="line-226"></span><span>      </span><span id="local-6989586621679045837"><span class="annot"><span class="annottext">Either IOException LPSECURITY_ATTRIBUTES
</span><a href="#local-6989586621679045837"><span class="hs-identifier hs-var">mh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO LPSECURITY_ATTRIBUTES
-&gt; IO (Either IOException LPSECURITY_ATTRIBUTES)
forall e a. Exception e =&gt; IO a -&gt; IO (Either e a)
</span><span class="hs-identifier hs-var">try</span></span><span> </span><span class="annot"><span class="annottext">(IO LPSECURITY_ATTRIBUTES
 -&gt; IO (Either IOException LPSECURITY_ATTRIBUTES))
-&gt; IO LPSECURITY_ATTRIBUTES
-&gt; IO (Either IOException LPSECURITY_ATTRIBUTES)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-227"></span><span>              </span><span class="annot"><span class="annottext">String
-&gt; OpenMode
-&gt; OpenMode
-&gt; Maybe LPSECURITY_ATTRIBUTES
-&gt; OpenMode
-&gt; OpenMode
-&gt; Maybe LPSECURITY_ATTRIBUTES
-&gt; IO LPSECURITY_ATTRIBUTES
</span><span class="hs-identifier hs-var">createFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679045845"><span class="hs-identifier hs-var">fileName</span></a></span><span>
</span><span id="line-228"></span><span>                         </span><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045844"><span class="hs-identifier hs-var">dwDesiredAccess</span></a></span><span>
</span><span id="line-229"></span><span>                         </span><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045843"><span class="hs-identifier hs-var">dwSharedMode</span></a></span><span>
</span><span id="line-230"></span><span>                         </span><span class="annot"><span class="annottext">Maybe LPSECURITY_ATTRIBUTES
</span><a href="#local-6989586621679045842"><span class="hs-identifier hs-var">lpSecurityAttributes</span></a></span><span>
</span><span id="line-231"></span><span>                         </span><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045841"><span class="hs-identifier hs-var">dwCreationDisposition</span></a></span><span>
</span><span id="line-232"></span><span>                         </span><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045840"><span class="hs-identifier hs-var">dwFlagsAndAttributes</span></a></span><span>
</span><span id="line-233"></span><span>                         </span><span class="annot"><span class="annottext">Maybe LPSECURITY_ATTRIBUTES
</span><a href="#local-6989586621679045839"><span class="hs-identifier hs-var">hTemplateFile</span></a></span><span>
</span><span id="line-234"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOException LPSECURITY_ATTRIBUTES
</span><a href="#local-6989586621679045837"><span class="hs-identifier hs-var">mh</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IOException</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HANDLE</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-235"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679045834"><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621679045834"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-236"></span><span>          </span><span class="hs-comment">-- unfortunately 'ERROR_PIPE_BUSY' is not part of 'errentry' in</span><span>
</span><span id="line-237"></span><span>          </span><span class="hs-comment">-- `libraries/cbits/Win32Utils.c`.</span><span>
</span><span id="line-238"></span><span>          </span><span id="local-6989586621679045833"><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045833"><span class="hs-identifier hs-var">errorCode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO OpenMode
</span><span class="hs-identifier hs-var">getLastError</span></span><span>
</span><span id="line-239"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OpenMode
</span><a href="#local-6989586621679045833"><span class="hs-identifier hs-var">errorCode</span></a></span><span> </span><span class="annot"><span class="annottext">OpenMode -&gt; OpenMode -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">OpenMode
</span><a href="System.Win32.NamedPipes.html#eRROR_PIPE_BUSY"><span class="hs-identifier hs-var">eRROR_PIPE_BUSY</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>            </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IOException -&gt; IO ()
forall e a. Exception e =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621679045834"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-241"></span><span>          </span><span class="hs-comment">-- all pipe instance were busy, wait 20s and retry; we ignore the</span><span>
</span><span id="line-242"></span><span>          </span><span class="hs-comment">-- result</span><span>
</span><span id="line-243"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; OpenMode -&gt; IO Bool
</span><a href="System.Win32.NamedPipes.html#waitNamedPipe"><span class="hs-identifier hs-var">waitNamedPipe</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679045845"><span class="hs-identifier hs-var">fileName</span></a></span><span> </span><span class="annot"><span class="annottext">OpenMode
</span><span class="hs-number">5_000</span></span><span>
</span><span id="line-244"></span><span>          </span><span class="annot"><span class="annottext">IO LPSECURITY_ATTRIBUTES
</span><a href="#local-6989586621679045838"><span class="hs-identifier hs-var">connectLoop</span></a></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679045829"><span class="annot"><span class="annottext">LPSECURITY_ATTRIBUTES
</span><a href="#local-6989586621679045829"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LPSECURITY_ATTRIBUTES -&gt; IO LPSECURITY_ATTRIBUTES
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">LPSECURITY_ATTRIBUTES
</span><a href="#local-6989586621679045829"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span class="hs-comment">-- | [ERROR_PIPE_BUSY](https://docs.microsoft.com/en-us/windows/win32/debug/system-error-codes--0-499-#ERROR_PIPE_BUSY):</span><span>
</span><span id="line-250"></span><span class="hs-comment">-- all pipe instances are busy.</span><span>
</span><span id="line-251"></span><span class="hs-comment">--</span><span>
</span><span id="line-252"></span><span class="annot"><a href="System.Win32.NamedPipes.html#eRROR_PIPE_BUSY"><span class="hs-identifier hs-type">eRROR_PIPE_BUSY</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ErrCode</span></span><span>
</span><span id="line-253"></span><span id="eRROR_PIPE_BUSY"><span class="annot"><span class="annottext">eRROR_PIPE_BUSY :: OpenMode
</span><a href="System.Win32.NamedPipes.html#eRROR_PIPE_BUSY"><span class="hs-identifier hs-var hs-var">eRROR_PIPE_BUSY</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpenMode
</span><span class="hs-number">231</span></span><span>
</span><span id="line-254"></span><span class="hs-pragma">{-# LINE 254 &quot;src\\System\\Win32\\NamedPipes.hsc&quot; #-}</span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span class="annot"><a href="System.Win32.NamedPipes.html#eRROR_SEM_TIMEOUT"><span class="hs-identifier hs-type">eRROR_SEM_TIMEOUT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ErrCode</span></span><span>
</span><span id="line-256"></span><span id="eRROR_SEM_TIMEOUT"><span class="annot"><span class="annottext">eRROR_SEM_TIMEOUT :: OpenMode
</span><a href="System.Win32.NamedPipes.html#eRROR_SEM_TIMEOUT"><span class="hs-identifier hs-var hs-var">eRROR_SEM_TIMEOUT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpenMode
</span><span class="hs-number">121</span></span><span>
</span><span id="line-257"></span><span class="hs-pragma">{-# LINE 257 &quot;src\\System\\Win32\\NamedPipes.hsc&quot; #-}</span><span>
</span><span id="line-257"></span></pre></body></html>